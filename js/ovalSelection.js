function questionHandler(e){const t=e.target.id;uncheckOtherCandidates(t.split("_")[0],t.split("_")[1]),reviewBtnHandler()}function uncheckOtherCandidatesRC(e,t,n){for(let d in ballot.contests[e].candidates)if(d!=t){const t=e+"_"+d+"_"+n;if(document.getElementById(t).checked=!1,isWriteinCandidate(e,d)){""!==document.getElementById(e+"_"+d+"_w").textContent&&clearOutRcWriteinAria(e,d)}}}function clearOutRcWriteinAria(e,t){for(let n in ballot.contests[e].candidates){const d=choiceLabel(parseInt(n)+1);document.getElementById(`${e}_${t}_${n}`).ariaLabel=`${d} Choice Write-in`}document.getElementById(`${e}_${t}_w`).textContent="",document.getElementById(`${e}_${t}_wh`).ariaLabel="Write-in"}function uncheckOtherCandidates(e,t){for(let n=0;n<ballot.contests[e].candidates.length;n++)if(n!=t){const t=e+"_"+n;document.getElementById(t).checked=!1,isWriteinCandidate(e,n)&&""!==document.getElementById(t+"_w").textContent&&clearRegWriteinAria(t)}}function clearRegWriteinAria(e){document.getElementById(`${e}_w`).textContent="",document.getElementById(`${e}_wh`).ariaLabel="Write-in",document.getElementById(e).ariaLabel="Write-in"}function regularHandler(e){const t=e.target.id,n=t.split("_"),d=n[0],o=n[1],i=ballot.contests[d].voteFor,c=isWriteinCandidate(d,o);let l=0;for(let e=0;e<ballot.contests[d].candidates.length;e++)1==document.getElementById(d+"_"+e).checked&&e!=o&&l++;if(l>=i&&i>1)return document.getElementById("maxChoicesOkButton").addEventListener("click",()=>{hideModal("maxChoicesModal",t)}),e.preventDefault(),showModal("maxChoicesModal",t),void document.getElementById("maxChoicesOkButton").focus();if(c){if(""===document.getElementById(t+"_w").textContent)return void showEnterWriteInModal(t);clearRegWriteinAria(t)}uncheckOthersAndReview(d,o,i)}function showEnterWriteInModal(e){document.getElementById("writeInName").value="",document.getElementById("writeInOkButton").addEventListener("click",()=>{writeInModalAnswer(e,"OK")}),document.getElementById("writeInCancelButton").addEventListener("click",()=>{writeInModalAnswer(e,"Cancel")}),event.preventDefault(),document.querySelector("#writeInName").addEventListener("keypress",function(t){"Enter"===event.key&&processWriteInName(e)}),showModal("writeInModal",e),document.getElementById("writeInName").focus()}function writeInModalAnswer(e,t){"Cancel"==t&&(document.getElementById("writeInName").value=""),processWriteInName(e)}function processWriteInName(e){let t=document.getElementById("writeInName").value.trim().toUpperCase();if(""!=t){const n=e.split("_"),d=n[0],o=n[1];if("R"===ballot.contests[d].contestType){if(!writeInNameAlreadyExisted(t,d,o)){document.getElementById(e).checked=!0;const n=ballot.contests[d].voteFor;addRegWriteinAria(t,e),uncheckOthersAndReview(d,o,n)}}else{document.getElementById(e).checked=!0,addRcWriteInAria(t,d,o),uncheckOthersRcAndReview(d,o,n[2])}}document.getElementById("writeInName").value="",hideModal("writeInModal",e)}function writeInNameAlreadyExisted(e,t,n){let d=!1;for(let o in ballot.contests[t].candidates){let i=t+"_"+o+"_w";if(o!=n&&null!=document.getElementById(i)){if(e===document.getElementById(i).textContent.toUpperCase()){d=!0;break}}}return d}function uncheckOthersAndReview(e,t,n){1===n&&uncheckOtherCandidates(e,t),reviewBtnHandler()}function addRegWriteinAria(e,t){document.getElementById(t+"_w").textContent=e,document.getElementById(`${t}_wh`).ariaLabel=`Write-in: ${e}`,document.getElementById(t).ariaLabel=`Write-in: ${e}`}function isWriteinCandidate(e,t){return ballot.contests[e].candidates[t].candidateCode.includes("writein")}function isIdRcWriteinCandidate(e){const t=e.split("_"),n=t[0],d=t[1];return ballot.contests[n].candidates[d].candidateCode.includes("writein")}function rankChoiceHandler(e){const t=e.target.id;let n=t.split("_"),d=n[0],o=n[1],i=n[2],c=otherSelectionInCol(d,o,i);""===c?processRcSelection(d,o,i):warningUncheckAnotherCandidate(t,c)}function processRcSelection(e,t,n){if(isWriteinCandidate(e,t)){if(""===document.getElementById(e+"_"+t+"_w").textContent)return void showEnterWriteInModal(e+"_"+t+"_"+n);{let d=!0;for(let o in ballot.contests[e].candidates)if(o!=n){const n=e+"_"+t+"_"+o;if(document.getElementById(n).checked){d=!1;break}}d&&clearOutRcWriteinAria(e,t)}}uncheckOthersRcAndReview(e,t,n)}function uncheckOthersRcAndReview(e,t,n){const d=otherSelectionInRow(e,t,n),o=otherSelectionInCol(e,t,n);""!=d&&(document.getElementById(d).checked=!1),""!=o&&(document.getElementById(o).checked=!1,split=o.split("_"),e=split[0],t=split[1],n=split[2],isWriteinCandidate(e,t)&&clearOutRcWriteinAria(e,t)),reviewBtnHandler()}function otherSelectionInRow(e,t,n){let d="";const o=ballot.contests[e].candidates.length;for(let i=0;i<o;i++)if(i!=n){const n=`${e}_${t}_${i}`;if(null!=document.getElementById(n)&&document.getElementById(n).checked){d=n;break}}return d}function otherSelectionInCol(e,t,n){let d="";const o=ballot.contests[e].candidates.length;for(let i=0;i<o;i++)if(i!=t){const t=`${e}_${i}_${n}`;if(document.getElementById(t).checked){d=t;break}}return d}function addRcWriteInAria(e,t,n){document.getElementById(t+"_"+n+"_w").textContent=e;for(let d in ballot.contests[t].candidates){const o=choiceLabel(parseInt(d)+1);document.getElementById(`${t}_${n}_${d}`).ariaLabel=`${o} Choice Write-in: ${e}`}document.getElementById(`${t}_${n}_wh`).ariaLabel=`Write-in: ${e}`}function warningUncheckAnotherCandidate(e,t){let n=e.split("_"),d=n[0],o=n[1],i=n[2];const c=otherSelectionInRow(d,o,i),l=choiceLabel(parseInt(i)+1),a=getCandidateName(e);let r=getCandidateName(t);document.getElementById("rcModalText").innerHTML=`For ${l} choice, you previously selected ${r}. Do you want to change your ${l} choice to ${a}?`,document.getElementById("yesButton").addEventListener("click",()=>{modalAnswer(e,t,c,"Yes",r)}),document.getElementById("noButton").addEventListener("click",()=>{modalAnswer(e,t,c,"No",r)}),event.preventDefault(),showModal("rcModal",e),document.getElementById("yesButton").focus()}function modalAnswer(e,t,n,d,o){if(hideModal("rcModal",e),document.getElementById(e).focus(),"Yes"==d){if(isIdRcWriteinCandidate(e)&&""===n)return void showEnterWriteInModal(e);if(document.getElementById(t).checked=!1,isIdRcWriteinCandidate(t)){const e=t.split("_");clearOutRcWriteinAria(e[0],e[1])}""!=n&&(document.getElementById(n).checked=!1),document.getElementById(e).checked=!0,reviewBtnHandler()}}function showModal(e,t){const n=document.getElementById(e);n.style="display:block;",document.getElementById("main").ariaHidden="true",document.getElementById("main").inert="true",document.getElementById("overlay").style="display:block;";const d=["button"],o=n.querySelectorAll(d)[0],i=n.querySelectorAll(d),c=i[i.length-1];document.addEventListener("keydown",function n(d){let i="Tab"===d.key,l="Escape"===d.key;(i||l)&&(d.shiftKey&&i?document.activeElement===o&&(c.focus(),d.preventDefault()):i&&!l?document.activeElement===c&&(o.focus(),d.preventDefault()):l&&!i&&(hideModal(e,t),document.removeEventListener("keydown",n)))}),o.focus()}function hideModal(e,t){document.getElementById("main").ariaHidden="false",document.getElementById("main").inert="false",document.getElementById("overlay").style="display:none;","rcModal"==e?(recreateNode(document.getElementById("yesButton")),recreateNode(document.getElementById("noButton")),document.getElementById("rcModal").style="display:none;",document.getElementById("overlay").style="display:none;"):"pwModal"==e?(document.getElementById("pwModal").style="display:none;",document.getElementById("overlay").style="display:none;"):"maxChoicesModal"==e?(document.getElementById("maxChoicesModal").style="display:none;",document.getElementById("overlay").style="display:none;"):"writeInModal"==e&&(recreateNode(document.getElementById("writeInOkButton")),recreateNode(document.getElementById("writeInCancelButton")),recreateNode(document.getElementById("writeInName")),document.getElementById("writeInModal").style="display:none;",document.getElementById("overlay").style="display:none;"),""!=t&&document.getElementById(t).focus()}function recreateNode(e,t){if(t)e.parentNode.replaceChild(e.cloneNode(!0),e);else{for(var n=e.cloneNode(!1);e.hasChildNodes();)n.appendChild(e.firstChild);e.parentNode.replaceChild(n,e)}}function getCandidate(e){return ballot.contests[e.split("_")[0]].candidates[e.split("_")[1]]}