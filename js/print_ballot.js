let contestIndex=0,candidateIndex=0;const notSelected="0.1|  not selected.",uniformedServices="or dependent, and absent from place of registration.";function getToday(){let e=new Date,t=String(e.getDate()).padStart(2,"0");return String(e.getMonth()+1).padStart(2,"0")+"/"+t+"/"+e.getFullYear()}function createPDF(){data=data.replace("MM/dd/yyyy",getToday());let e=data.split("||"),t=e[0],a=t.split("|"),n=new PdfUA(a[1],a[2]);for(let a=1;a<e.length;a++){let d=(t=e[a]).charAt(0);switch(d){case"1":n.addPage();break;case"2":if(t.endsWith(notSelected)){let n=ballot.contests[contestIndex].candidates[candidateIndex].selected;n>0&&(e[a+n]=e[a+n].replace(/.$/,"1"),t=updateCandidateSelection(t,n)),toNextCandidate()}else t.endsWith(uniformedServices)&&(document.getElementsByName("uniformOrOverseas")[0].checked?(e[a-1]=e[a-1].replace(/.$/,"1"),addDraw(n,e[a-1])):e[a+1]=e[a+1].replace(/.$/,"1"));addElement(n,t);break;case"3":addArtifactText(n,t);break;case"4":case"5":case"6":addDraw(n,t);break;case"7":let l=t.substr(2,t.length-2);n.savePdf(l);break;default:alert("createPDF()- Command "+d+" is invalid: "+t)}}}function updateCandidateSelection(e,t){let a=ballot.contests[contestIndex];if("RC"==a.contestType){let a=["","first","second","third","fourth","fifth","sixth"];e=e.replace(notSelected,"0.1|  selected as "+a[t]+" choice.")}else e=e.replace(notSelected,"0.1|  selected.");let n=a.candidates[candidateIndex];return"writein"==n.candidateCode&&(e=addWriteInName(e,n.candidateName)),e}function toNextCandidate(){candidateIndex++,ballot.contests[contestIndex].candidates.length==candidateIndex&&(candidateIndex=0,contestIndex++)}function addWriteInName(e,t){let a=e.split("|"),n="";for(let e=0;e<9;e++)n+=a[e]+"|";let d=a[4],l=a[10]-6,c=a[7]-1;n+=d+"|"+l+"|"+a[6]+"|"+c+"| "+t;for(let e=9;e<a.length;e++)n+="|"+a[e];return n}function addElement(e,t){let a=t.split("|"),n=a[1];switch(n){case"1":n=elementType.part;break;case"2":n=elementType.section;break;case"3":n=elementType.div;break;case"4":n=elementType.header1;break;case"5":n=elementType.header2;break;case"6":n=elementType.header3;break;case"7":n=elementType.paragraph}let d=a[3];if(4==a.length)e.addElement(n,a[2],d);else{let t=getTextElements(a,4);e.addElement(n,a[2],d,t)}}function addArtifactText(e,t){let a=getTextElements(t.split("|"),1);e.addArtifactText(a)}function addDraw(e,t){let a=t.split("|"),n=a[0],d=parseFloat(a[1]),l=parseFloat(a[2]),c=parseFloat(a[3]),r=parseFloat(a[4]),s=parseFloat(a[5]);if("4"==n)e.drawLine(d,l,c,r,s);else{let t=!1;a.length>6&&(t="0"!=a[6]),"5"==n?e.drawRectangle(d,l,c+s,r,s,t):e.drawOval(d,l+r/2,c+s/2,r,s,t)}}function getTextElements(e,t){let a=t,n=[];for(;a<e.length-1;){let t=parseFloat(e[a]),d=parseFloat(e[a+1]),l="0"==e[a+2]?"F0":"F1",c=parseFloat(e[a+3]),r=e[a+4];n.push(new TextElement(t,d,l,c,r)),a+=5}return n}