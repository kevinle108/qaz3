const selectedVote="<p>{CANDIDATE_NAME}</p>",rankedVote="<p>{RANK} choice: {CANDIDATE_NAME}</p>",noSelection='<div class="reviewPageNoSelection">No Selection</div>',reviewContestHtml='\n    <div id="review_contest_{REVIEW_ID}" class="reviewContest" role="button" tabIndex="0">\n        <p id="review_header_{REVIEW_ID}" class="reviewContestHeader">{CONTESTNAME}  (Vote for {VOTEFOR})</p>\n        <div id="review_candidates_{REVIEW_ID}" class="reviewCandidates">\n            {CANDIDATES}\n        </div>\n    </div>   \n';function syncSelectedVotesToBallotData(){return ballot.contests.forEach((e,t)=>{e.candidates.forEach((n,d)=>{n.selected=0;let c=`${t}_${d}`;if("RC"==e.contestType)for(let o=0;o<e.candidates.length;o++)c=`${t}_${d}_${o}`,document.getElementById(c).checked&&(n.selected=o+1,n.candidateCode.includes("writein")&&(n.candidateName=document.getElementById(`${t}_${d}_w`).textContent));else document.getElementById(c).checked&&(n.selected=1,n.candidateCode.includes("writein")&&(n.candidateName=document.getElementById(`${t}_${d}_w`).textContent))})}),ballot}function removeAllChildNodes(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function reviewBtnHandler(e){syncSelectedVotesToBallotData();document.getElementById("reviewPage");const t=document.querySelector("#reviewBody");t.innerHTML="",ballot.contests.forEach((e,n,d)=>{t.insertAdjacentHTML("beforeend",buildReview(e,n))});const n=document.querySelectorAll(".reviewContest");n.forEach(e=>e.addEventListener("click",reviewBoxesHandler)),n.forEach(e=>e.addEventListener("keydown",e=>{if(" "===e.key||"Enter"===e.key){const t=e.target.id.replace("review_","");document.getElementById(t).focus(),document.getElementById(t).scrollIntoView()}}))}function doneAndCreatePdf(){syncSelectedVotesToBallotData(),createBallotPdf(ballot)}function buildReview(e,t){let n=reviewContestHtml;n=n.replace(/{REVIEW_ID}/g,t);let d=e.contestName+" "+e.contestSubtitle;return d=d.trim(),n=n.replace("{CONTESTNAME}",d),n="RC"===e.contestType?n.replace("Vote for {VOTEFOR}","Rank Choice"):n.replace("{VOTEFOR}",e.voteFor),n="RC"===e.contestType?n.replace("{CANDIDATES}",buildReviewRankedVotes(e,t)):n.replace("{CANDIDATES}",buildReviewSelectedVotes(e,t))}function buildReviewSelectedVotes(e,t){let n="";return e.candidates.forEach((e,d)=>{1===e.selected&&(e.candidateCode.includes("writein")?n+=selectedVote.replace("{CANDIDATE_NAME}",`Write-in: ${e.candidateName}`):n+=selectedVote.replace("{CANDIDATE_NAME}",getCandidateName(t+"_"+d)))}),""===n.trim()&&(n+=noSelection),n}function buildReviewRankedVotes(e,t){let n="";for(let d=1;d<e.candidates.length+1;d++)for(let c=0;c<e.candidates.length;c++)e.candidates[c].selected===d&&(n=(n+=rankedVote).replace("{RANK}",choiceLabel(d)).replace("{CANDIDATE_NAME}",getCandidateName(t+"_"+c)));return""===n.trim()&&(n+=noSelection),n}function reviewBoxesHandler(e){const t=this.id.replace("review_","");document.getElementById(t).focus(),document.getElementById(t).scrollIntoView()}function backBtnHandler(){const e=document.getElementById("reviewPage"),t=document.getElementById("selection"),n=document.querySelector("header");e.style.display="none",t.style.display="block",document.querySelector('input[type="checkbox"]').focus(),document.getElementById("reviewBody").innerHTML="",n.scrollIntoView()}function getCandidateName(e){const t=getCandidate(e),n=e.split("_")[0];let d="";if(t.candidateCode.includes("writein")){const t=e.split("_");d="Write-in: "+document.getElementById(t[0]+"_"+t[1]+"_w").textContent}else if(d=t.candidateName.replace(/<br>/g," and "),"Q"!=ballot.contests[n].contestType){let e=t.candidateSubtitle;if(e.includes("<br>")){let t=e.indexOf("<br>");d+=", "+e.substr(t,e.length-t).replace(/<br>/g,"")}else e.match(/^\d/)||(d+=", "+e)}return d.includes("&quot;")&&(d=d.replace(/&quot;/g,'"')),d}